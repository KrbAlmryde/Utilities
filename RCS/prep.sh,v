head	1.6;
access;
symbols;
locks
	kylealmryde:1.6; strict;
comment	@# @;


1.6
date	2011.08.23.04.09.48;	author kylealmryde;	state Exp;
branches;
next	1.5;

1.5
date	2011.08.23.04.05.27;	author kylealmryde;	state Exp;
branches;
next	1.4;

1.4
date	2011.08.23.00.01.10;	author kylealmryde;	state Exp;
branches;
next	1.3;

1.3
date	2011.08.22.23.47.07;	author kylealmryde;	state Exp;
branches;
next	1.2;

1.2
date	2011.08.22.23.37.50;	author kylealmryde;	state Exp;
branches;
next	1.1;

1.1
date	2011.08.10.18.24.26;	author kylealmryde;	state Exp;
branches;
next	;


desc
@Ive made a lot of changes, particularly with regards to names etc, lots of refactoring
@


1.6
log
@I fixed the 2swap command I think, it needed to swap just the BRIK file, not the HEAD
@
text
@# This is a prep script designed to perform to3d on functional Pfiles and anatomical e-files in
# order to create epan, spgr, and fse files respectively
####################################################################################################
#
# Source the experiment profile

. $UTL/${1}_profile

cd ${func_dir}
####################################################################################################
# Based on the value of z1 designate I or S as the direction of the top z
# slice and the other as the bottom

if [ ${z1} = S ]
then
	z2=I
else
	if [ ${z1} = I ]
	then
		z2=S
	fi
fi
####################################################################################################
# Based on the value of z1spgr designate L or R as the direction of the top z
# slice and the other as the bottom

if [ ${z1spgr} = R ]
then
	z2spgr=L
else
	if [ ${z1spgr} = L ]
	then
		z2spgr=R
	fi
fi
####################################################################################################
								########### START OF MAIN ############
####################################################################################################

echo "---------------------------------prep.sh---------------------------------"
echo "--------------------------------- ${runnm} ---------------------------------"
####################################################################################################
# Perform to3d on the raw unpacked P files. In addition, any byte swapping that need be done is
# performed on the dataset. See the experiment profile if the appropriate parameter variables are
# not provided

echo ""
echo "reconstructing ${runnm}_epan....."
echo ""

to3d -epan -prefix rm.${runnm}_epan -text_outliers ${runnm}_outliers.txt -xFOV ${halffov}R-L -yFOV \
	${halffov}A-P -zSLAB ${z}${z1}-${z}${z2} -time:tz ${nfs} ${nas} ${tr} @@${UTL}/offsets.1D ${run}.*

2swap ${runnm}_epan+orig.BRIK

3dToutcount -save ${runnm}_outs ${runnm}_epan+orig | 1dplot -stdin ${runnm}_outs+orig

echo ""
####################################################################################################
echo "Look to see what type of e-file it is and then run the appropriate command"

#cd ${anat_dir}

#These lines have been commented out because I already have fse and epan files. I will still need
#to put an if then statement in here however to ensure I dont keep renaming and rebuilding these
#files.
#
#
#echo "rename fse and spgr efiles"
#rename_fse e*s
#rename_spgr e*s
#
# echo "reconstructing ${fse}....."
# to3d -fse -prefix ${fse} -xFOV ${halffov}R-L -yFOV ${halffov}A-P -zSLAB \
# 	${z}${z1}-${z}${z2} e*2i*
#
# echo "reconstructing ${spgr}....."
# to3d -spgr -prefix ${spgr} -xFOV ${anatfov}A-P -yFOV ${anatfov}S-I -zSLAB \
# 	${z}${z1spgr}-${z}${z2spgr} e*7i*
#
#echo "Move the raw P and e files to their own directory so we can keep things clean"
#
#This marks the end of this commented block

####################################################################################################
echo "Thats all there is, there isnt anymore...."
@


1.5
log
@I changed save_outliers to text_outliers to see if that will save the report generated in the X11 window will instead be printed to a text file.
@
text
@d54 1
a54 1
2swap
@


1.4
log
@figured out the problem with 2swap, it needed a wildcard * to properly swap the entire image
@
text
@d51 1
a51 1
to3d -epan -prefix ${runnm}_epan -save_outliers ${runnm}_outliers.txt -xFOV ${halffov}R-L -yFOV \
d54 3
a56 1
3dToutcount -save ${runnm}_outs ${runnm}_epan+orig | 1dplot -stdin ${runnm}_outcounts.txt
a57 1
2swap ${runnm}_epan+orig*
d62 1
a62 13
cd ${anat_dir}

echo "rename fse and spgr efiles"
rename_fse e*s
rename_spgr e*s

echo "reconstructing ${fse}....."
to3d -fse -prefix ${fse} -xFOV ${halffov}R-L -yFOV ${halffov}A-P -zSLAB \
	${z}${z1}-${z}${z2} e*2i*

echo "reconstructing ${spgr}....."
to3d -spgr -prefix ${spgr} -xFOV ${anatfov}A-P -yFOV ${anatfov}S-I -zSLAB \
	${z}${z1spgr}-${z}${z2spgr} e*7i*
d64 17
d82 2
a83 1

@


1.3
log
@I think I corrected the issue with the efile names.
@
text
@d54 1
a54 1
3dToutcount -save ${runnm}_outcounts.txt ${runnm}_epan+orig | 1dplot -stdin ${runnm}_outcounts.txt
d56 1
a56 1
2swap ${runnm}_epan+orig
@


1.2
log
@Made a lot of changes that I dont remember, will need to look back another time to see exactly. That being said, I fixed a couple of problems I was having with to3d.
I am still having issues with 2swap, I may just get rid of it altogether
@
text
@d40 1
a40 1
echo "---------------------------------		prep.sh		 ---------------------------------"
d54 1
a54 1
3dToutcount -save ${runnm}_outcounts.txt | 1dplot -stdin ${runnm}_outcounts.txt
d63 3
a65 3
rename_fse $efile
rename_spgr $efile

d69 1
a69 1
	${z}${z1}-${z}${z2} ${efile}2i*
d73 1
a73 1
	${z}${z1spgr}-${z}${z2spgr} ${efile}7i*
@


1.1
log
@Initial revision
@
text
@d8 2
d16 1
a16 1
				z2=I
d18 4
a21 4
				if [ ${z1} = I ]
				then
				z2=S
				fi
d29 1
a29 1
				z2spgr=L
d31 4
a34 4
				if [ ${z1} = L ]
				then
				z2spgr=R
				fi
d41 1
a41 1
echo "--------------------------------- ${subj} ${run} ---------------------------------"
d49 1
d51 2
a52 2
to3d -epan -prefix ${func_dir}/${runnm}_epan -save_outliers ${func_dir}/${runnm}_outliers.txt -time:tz ${nfs} ${nas} ${tr} \
	@@offsets.1D ${func_dir}/${run}.\*
d54 1
a54 3
# to3d -epan -prefix ${func_dir}/${runnm}_epan -save_outliers ${func_dir}/${runnm}_outliers.txt \
# 	-xFOV ${halffov}R-L -yFOV ${halffov}A-P -zSLAB ${z}${z1}-${z}${z2} -time:tz ${nfs} \
# 	${nas} ${tr} @@${UTL}/offsets.1D ${func}/${run}.*
d56 1
a56 1
echo "								....then byte swapping"
d58 7
a65 3
2swap ${func_dir}/${runnm}_epan+orig
####################################################################################################
# Look to see what type of e-file it is and then run the appropriate command
d67 7
a73 1
if [ -f ${anat}/e????s2* ]; then
d75 1
a75 5
	echo "reconstructing $fse....."
	rename_fse
	to3d -fse -prefix ${anat_dir}/${fse} -xFOV ${halffov}R-L -yFOV ${halffov}A-P -zSLAB \
		${z}${z1}-${z}${z2} ${anat_dir}/${e_fse}*
else
a76 7
	echo "reconstructing $spgr....."
	rename_spgr
	to3d -spgr -prefix ${anat_dir}/${spgr} -xFOV ${anatfov}A-P -yFOV ${anatfov}S-I -zSLAB \
		${z}${z1spgr}-${z}${z2spgr} ${anat}/${e_spgr}*
fi
####################################################################################################
# Move the raw P and e files to their own directory so we can keep things clean
a77 2
mv ${func}/${run}.????	${subj_dir}/Orig
mv ${anat}/e????s* ${subj_dir}/Orig
d79 1
a79 1
# Thats all there is, there isnt anymore....
@
