
Imon - monitor real-time acquisition of I-files

    This program is intended to be run during a scanning session
    on a GE scanner, to monitor the collection of I-files.  The
    user will be notified of any missing slice or any slice that
    is acquired out of order.

    It is recommended that the user runs 'Imon' just after the
    scanner is first prepped, and then watches for error messages
    during the scanning session.  The user should terminate the
    program whey they are done with all runs.

    Note that 'Imon' can also be run separate from scanning, either
    to verify the integrity of I-files, or to create a GERT_Reco2
    script, which is used to create AFNI datasets.

    At the present time, the user must use <ctrl-c> to terminate
    the program.

  ---------------------------------------------------------------
  usage: Imon [options] -start_dir DIR

  ---------------------------------------------------------------
  examples (no real-time options):

    Imon -start_dir 003
    Imon -help
    Imon -start_dir 003 -GERT_reco2 -quit
    Imon -start_dir 003 -nt 120 -start_file 043/I.901
    Imon -debug 2 -nice 10 -start_dir 003

  examples (with real-time options):

    Imon -start_dir 003 -rt
    Imon -start_dir 003 -rt -host pickle
    Imon -start_dir 003 -nt 120 -rt -host pickle

  ** detailed real-time example:

    This example scans data starting from directory 003, expects
    160 repetitions (TRs), and invokes the real-time processing,
    sending data to a computer called some.remote.computer.name
    (where afni is running, and which considers THIS computer to
    be trusted - see the AFNI_TRUSTHOST environment variable).

    Multiple DRIVE_AFNI commands are passed through '-drive_afni'
    options, one requesting to open an axial image window, and
    another requesting an axial graph, with 160 data points.

    See README.driver for acceptable DRIVE_AFNI commands.

    Also, multiple commands specific to the real-time plugin are
    passed via the '-rt_cmd' options.  The 'REFIX command sets the
    prefix for the datasets output by afni.  The GRAPH_XRANGE and
    GRAPH_YRANGE commands set the graph dimensions for the 3D
    motion correction graph (only).  And the GRAPH_EXPR command
    is used to replace the 6 default motion correction graphs with
    a single graph, according to the given expression, the square
    root of the average squared entry of the 3 rotation params,
    roll, pitch and yaw, ignoring the 3 shift parameters, dx, dy
    and dz.

    See README.realtime for acceptable DRIVE_AFNI commands.

    Imon                                                   \
       -start_dir 003                                      \
       -nt 160                                             \
       -rt                                                 \
       -host some.remote.computer.name                     \
       -drive_afni 'OPEN_WINDOW axialimage'                \
       -drive_afni 'OPEN_WINDOW axialgraph pinnum=160'     \
       -rt_cmd 'PREFIX eat.more.cheese'                    \
       -rt_cmd 'GRAPH_XRANGE 160'                          \
       -rt_cmd 'GRAPH_YRANGE 1.02'                         \
       -rt_cmd 'GRAPH_EXPR sqrt((d*d+e*e+f*f)/3)'            

  ---------------------------------------------------------------
  notes:

    - Once started, this program exits only when a fatal error
      occurs (single missing or out of order slices are not
      considered fatal).

      ** This has been modified.  The '-quit' option tells Imon
         to terminate once it runs out of new data to use.

    - To terminate this program, use <ctrl-c>.

  ---------------------------------------------------------------
  main option:

    -start_dir DIR     : (REQUIRED) specify starting directory

        e.g. -start_dir 003

        The starting directory, DIR, must be of the form 00n,
        where n is a digit.  The program then monitors all
        directories of the form ??n, created by the GE scanner.

        For instance, with the option '-start_dir 003', this
        program watches for new directories 003, 023, 043, etc.

  ---------------------------------------------------------------
  real-time options:

    -rt                : specify to use the real-time facility

        With this option, the user tells 'Imon' to use the real-time
        facility, passing each volume of images to an existing
        afni process on some machine (as specified by the '-host'
        option).  Whenever a new volume is acquired, it will be
        sent to the afni program for immediate update.

        Note that afni must also be started with the '-rt' option
        to make use of this.

        Note also that the '-host HOSTNAME' option is not required
        if afni is running on the same machine.

    -drive_afni CMND   : send 'drive afni' command, CMND

        e.g.  -drive_afni 'OPEN_WINDOW axialimage'

        This option is used to pass a single DRIVE_AFNI command
        to afni.  For example, 'OPEN_WINDOW axialimage' will open
        such an axial view window on the afni controller.

        Note: the command 'CMND' must be given in quotes, so that
              the shell will send it as a single parameter.

        Note: this option may be used multiple times.

        See README.driver for more details.

    -host HOSTNAME     : specify the host for afni communication

        e.g.  -host mycomputer.dot.my.network
        e.g.  -host 127.0.0.127
        e.g.  -host mycomputer
        the default host is 'localhost'

        The specified HOSTNAME represents the machine that is
        running afni.  Images will be sent to afni on this machine
        during the execution of 'Imon'.

        Note that the environment variable AFNI_TRUSTHOST must be
        set on the machine running afni.  Set this equal to the
        name of the machine running Imon (so that afni knows to
        accept the data from the sending machine).

    -rev_byte_order   : pass the reverse of the BYTEORDER to afni

        Reverse the byte order that is given to afni.  In case the
        detected byte order is not what is desired, this option
        can be used to reverse it.

        See the (obsolete) '-swap' option for more details.

    -rt_cmd COMMAND   : send COMMAND(s) to realtime plugin

        e.g.  -rt_cmd 'GRAPH_XRANGE 120'
        e.g.  -rt_cmd 'GRAPH_XRANGE 120 \n GRAPH_YRANGE 2.5'

        This option is used to pass commands to the realtime
        plugin.  For example, 'GRAPH_XRANGE 120' will set the
        x-scale of the motion graph window to 120 (repetitions).

        Note: the command 'COMMAND' must be given in quotes, so
        that the shell will send it as a single parameter.

        Note: this option may be used multiple times.

        See README.realtime for more details.

    -swap  (obsolete) : swap data bytes before sending to afni

        Since afni may be running on a different machine, the byte
        order may differ there.  This option will force the bytes
        to be reversed, before sending the data to afni.

        ** As of version 3.0, this option should not be necessary.
           'Imon' detects the byte order of the image data, and then
           passes that information to afni.  The realtime plugin
           will (now) decide whether to swap bytes in the viewer.

           If for some reason the user wishes to reverse the order
           from what is detected, '-rev_byte_order' can be used.

    -zorder ORDER     : slice order over time

        e.g. -zorder alt
        e.g. -zorder seq
        the default is 'alt'

        This options allows the user to alter the slice
        acquisition order in real-time mode, similar to the slice
        pattern of the '-sp' option.  The main differences are:
            o  only two choices are presently available
            o  the syntax is intentionally different (from that
               of 'to3d' or the '-sp' option)

        ORDER values:
            alt   : alternating in the Z direction (over time)
            seq   : sequential in the Z direction (over time)

  ---------------------------------------------------------------
  other options:

    -debug LEVEL       : show debug information during execution

        e.g.  -debug 2
        the default level is 1, the domain is [0,3]
        the '-quiet' option is equivalent to '-debug 0'

    -help              : show this help information

    -hist              : display a history of program changes

    -nice INCREMENT    : adjust the nice value for the process

        e.g.  -nice 10
        the default is 0, and the maximum is 20
        a superuser may use down to the minimum of -19

        A positive INCREMENT to the nice value of a process will
        lower its priority, allowing other processes more CPU
        time.

    -nt VOLUMES_PER_RUN : set the number of time points per run

        e.g.  -nt 120

        With this option, if a run stalls before the specified
        VOLUMES_PER_RUN is reached (notably including the first
        run), the user will be notified.

        Without this option, Imon will compute the expected number
        of time points per run based on the first run (and will
        allow the value to increase based on subsequent runs).
        Therefore Imon would not detect a stalled first run.

    -quiet             : show only errors and final information

    -quit              : quit when there is no new data

        With this option, the program will terminate once a delay
        in new data occurs.  This is most appropriate to use when
        the image files have already been collected.

    -start_file S_FILE : have Imon process starting at S_FILE

        e.g.  -start_file 043/I.901

        With this option, any earlier I-files will be ignored
        by Imon.  This is a good way to start processing a later
        run, if it desired not to look at the earlier data.

        In this example, all files in directories 003 and 023
        would be ignored, along with everything in 043 up through
        I.900.  So 043/I.901 might be the first file in run 2.

    -version           : show the version information

  ---------------------------------------------------------------
  GERT_Reco2 options:

    -GERT_Reco2        : output a GERT_Reco2 script

        Create a script called 'GERT_Reco2', similar to the one
        that Ifile creates.  This script may be run to create the
        AFNI datasets corresponding to the I-files.

    -gert_outdir OUTPUT_DIR  : set output directory in GERT_Reco2

        e.g. -gert_outdir subject_A7
        e.g. -od subject_A7
        the default is '-gert_outdir afni'

        This will add '-od OUTPUT_DIR' to the @RenamePanga command
        in the GERT_Reco2 script, creating new datasets in the
        OUTPUT_DIR directory, instead of the 'afni' directory.

    -sp SLICE_PATTERN  : set output slice pattern in GERT_Reco2

        e.g. -sp alt-z
        the default is 'alt+z'

        This options allows the user to alter the slice
        acquisition pattern in the GERT_Reco2 script.

        See 'to3d -help' for more information.

  ---------------------------------------------------------------

  Author: R. Reynolds - version 3.3a (March 22, 2005)

                        (many thanks to R. Birn)

